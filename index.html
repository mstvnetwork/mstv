<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>MSTV Network | AAINA DTH FREE</title>

    <!-- 1. CRITICAL: HLS Library placed in HEAD to prevent "Hls is not defined" error -->
    <script src="https://cdn.jsdelivr.net"></script>

    <link href="https://fonts.googleapis.com" rel="stylesheet">

    <style>
        body { margin: 0; padding: 0; font-family: 'Poppins', sans-serif; color: #E0E0E0; background: #0F1115; overflow-x: hidden; }
        .title-3d { font-size: 3.5em; text-align: center; margin-top: 40px; margin-bottom: 30px; color: #FFFFFF; text-shadow: 0 4px 8px rgba(0, 0, 0, 0.4); font-weight: 700; }
        .scrolling-container { width: 100%; overflow: hidden; background: #1A1D20; padding: 15px 0; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3); }
        .scrolling-content { display: inline-flex; align-items: center; gap: 40px; padding-left: 100%; white-space: nowrap; animation: scroll-text-logos 40s linear infinite; color: #90EE90; font-weight: 500; }
        @keyframes scroll-text-logos { 0% { transform: translateX(0%); } 100% { transform: translateX(-100%); } }
        .channel-selector-text { text-align: center; font-size: 1.8em; margin: 4vh 0 2vh; color: #FFFFFF; font-weight: 600; }
        .channel-selection { margin-bottom: 5vh; display: flex; justify-content: center; }
        select { padding: 0.7em 1.5em; font-size: 1.2em; background: #1A1D20; color: #90EE90; border: 1px solid #90EE90; border-radius: 8px; width: 90%; max-width: 450px; text-align: center; appearance: none; cursor: pointer; }
        .player-container { position: relative; width: 90%; max-width: 1100px; aspect-ratio: 16 / 9; margin: 0 auto 60px; border-radius: 12px; overflow: hidden; background: #000; box-shadow: 0 8px 16px rgba(0, 0, 0, 0.5); }
        #media-player, #video-player, #placeholder-image { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; }
        .live-stamp { position: absolute; top: 15px; left: 15px; background: #E50914; color: white; padding: 5px 15px; font-weight: 700; border-radius: 4px; z-index: 10; }
        .loading-indicator { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0, 0, 0, 0.8); color: #90EE90; padding: 10px 20px; display: none; z-index: 20; }
        footer { padding: 50px 20px; background: #1A1D20; text-align: center; border-top: 1px solid rgba(255,255,255,0.1); }
        .facebook-follow { text-align: center; margin: 20px 0; }
        .facebook-follow a { color: #1877F2; text-decoration: none; font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 10px; }
    </style>
</head>
<body>

    <div class="title-3d">AAINA DTH FREE</div>
    
    <div class="scrolling-container">
        <div class="scrolling-content">
            üåç AAINA DTH FREE‚Äì Your Gateway to Free Live TV! Music, Movies, Drama & More, Anytime, Anywhere! | 50+ Free Channels | Zero Subscription!
        </div>
    </div>
    
    <div class="channel-selector-text">Select Channel</div>
     
    <div class="channel-selection">
        <select id="channel-select">
            <option value="">üëâüì∫üì∫üì∫ Loading Channels...</option>
        </select>
    </div>
        
    <div class="player-container">
        <iframe id="media-player" style="display:none;" allow="autoplay; encrypted-media" allowfullscreen></iframe>
        <video id="video-player" style="display:none;" autoplay playsinline controls></video>
        <img id="placeholder-image" src="https://raw.githubusercontent.com" alt="Stream Placeholder" />
        
        <div class="live-stamp" id="live-stamp" style="display:none;">LIVE</div>
        <div class="loading-indicator" id="loading">Loading stream...</div>
    </div>

    <div class="facebook-follow">
        <a href="https://www.facebook.com" target="_blank">
            <img src="https://upload.wikimedia.org" width="24" alt="FB" />
            Follow us on Facebook
        </a>
    </div>
     
    <footer>
        <div class="copyright">¬© 2025 MSTV INDIA. All rights reserved.</div>
    </footer>

    <script>
        const select = document.getElementById('channel-select');
        const videoPlayer = document.getElementById('video-player');
        const iframePlayer = document.getElementById('media-player');
        const placeholder = document.getElementById('placeholder-image');
        const loading = document.getElementById('loading');
        const liveStamp = document.getElementById('live-stamp');
      
        let hlsInstance = null;
        let channelsData = [];
        let lastKnownJsonContent = null;

        // 2. FIXED PATH: Using root-relative path to prevent CORS errors
        const JSON_URL = "/mstv/channels.json";
      
        async function fetchChannelsJson() {
          try {
            const response = await fetch(`${JSON_URL}?t=${Date.now()}`);
            if (!response.ok) throw new Error('Fetch failed');
            
            const json = await response.json();
            const jsonString = JSON.stringify(json);
      
            if (lastKnownJsonContent !== jsonString) {
              lastKnownJsonContent = jsonString;
              channelsData = json;
              
              const currentVal = select.value;
              select.innerHTML = '<option value="">üëâüì∫üì∫üì∫ Select Channel</option>';
              channelsData.forEach((channel, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = channel.name;
                select.appendChild(option);
              });
              select.value = currentVal;
            }
          } catch (e) {
            console.error('JSON Error:', e);
          }
        }
      
        function playChannel(channel) {
            loading.style.display = 'block';
            placeholder.style.display = 'none';
            liveStamp.style.display = 'none';
            
            if (hlsInstance) { hlsInstance.destroy(); hlsInstance = null; }
            videoPlayer.pause();
            videoPlayer.style.display = 'none';
            iframePlayer.style.display = 'none';
            iframePlayer.src = '';

            if (!channel) {
                placeholder.style.display = 'block';
                loading.style.display = 'none';
                return;
            }

            if (channel.type === 'hls') {
                videoPlayer.style.display = 'block';
                // 3. CHECK: Hls library check
                if (typeof Hls !== 'undefined' && Hls.isSupported()) {
                    hlsInstance = new Hls();
                    hlsInstance.loadSource(channel.url);
                    hlsInstance.attachMedia(videoPlayer);
                    hlsInstance.on(Hls.Events.MANIFEST_PARSED, () => { 
                        videoPlayer.play(); 
                        loading.style.display = 'none'; 
                        liveStamp.style.display = 'block';
                    });
                } else if (videoPlayer.canPlayType('application/vnd.apple.mpegurl')) {
                    videoPlayer.src = channel.url;
                    videoPlayer.play();
                    loading.style.display = 'none';
                    liveStamp.style.display = 'block';
                }
            } else if (channel.type === 'iframe') {
                iframePlayer.src = channel.url;
                iframePlayer.style.display = 'block';
                loading.style.display = 'none';
                liveStamp.style.display = 'block';
            }
        }
      
        select.addEventListener('change', () => {
          const index = select.value;
          playChannel(index === '' ? null : channelsData[index]);
        });
      
        fetchChannelsJson();
        setInterval(fetchChannelsJson, 15000);
    </script>
</body>
</html>
