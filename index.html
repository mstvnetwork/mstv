<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="description" content="MSTV Network offers a variety of live TV channels including music, movies, and more. Watch your favorite channels online for free.">
    <meta name="keywords" content="live TV, MSTV Network, free TV, live channels, streaming, music, bollywood, saga music">
    <meta name="robots" content="index, follow">
    <meta property="og:title" content="MSTV Network">
    <meta property="og:description" content="Stream live TV channels including music, movies, and more on MSTV Network.">
    <meta property="og:image" content="https://raw.githubusercontent.com/mstvnetwork/mstv2/refs/heads/main/Design-Studio-2025-01-20%20(2).png">
    <meta property="og:url" content="https://mstvnet.netlify.app/">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="MSTV Network">
    <meta property="twitter:description" content="Stream live TV channels including music, movies, and more on MSTV Network.">
    <meta property="twitter:image" content="https://raw.githubusercontent.com/mstvnetwork/mstv2/refs/heads/main/Design-Studio-2025-01-20%20(2).png">
    <meta property="twitter:url" content="https://mstvnet.netlify.app/">

    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebPage",
        "name": "MSTV Network",
        "description": "Stream live TV channels including music, movies, and more.",
        "url": "https://yourwebsite.com",
        "publisher": {
            "@type": "Organization",
            "name": "MSTV Network",
            "logo": {
                "@type": "ImageObject",
                "url": "https://raw.githubusercontent.com/mstvnetwork/mstv2/refs/heads/main/Design-Studio-2025-01-20%20(2).png"
            }
        }
    }
    </script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

    <style>
        html {
            font-size: 16px;
            background: linear-gradient(145deg, #1A0D3C, #3F0057);
            min-height: 100%;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Poppins', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #fff;
            width: 100%;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Custom styles for the logo and subtitle */
        .header-content {
            text-align: center;
            margin-top: 30px;
            margin-bottom: 20px;
        }

        .header-content .mstv-logo {
            /* Adjusted logo size for impressiveness */
            width: 220px; /* Increased size */
            height: auto;
            display: block;
            margin: 0 auto 10px;
            /* Adjusted shadow for new size */
            box-shadow: 0 0 20px rgba(0, 255, 231, 0.7);
            border-radius: 10px;
        }

        .header-content .subtitle {
            font-size: 1.8em;
            /* Changed color for eye-catching pop-out effect */
            color: #FF4FD8; /* Vibrant pink/magenta */
            /* Enhanced text-shadow to match new color and pop more */
            text-shadow: 0 0 10px #FF4FD8, 0 0 20px #ff007b, 0 0 30px #ff007b;
            animation: glow 2s infinite alternate;
            margin-top: 10px;
        }

        @keyframes glow {
            0% { text-shadow: 0 0 10px #FF4FD8, 0 0 20px #ff007b; }
            100% { text-shadow: 0 0 20px #FF4FD8, 0 0 30px #ff007b; }
        }

        .scrolling-text {
            overflow: hidden;
            white-space: nowrap;
            padding: 12px 0;
            margin: 20px 0;
            background: rgba(255, 255, 255, 0.05);
            border-top: 2px solid #00ffe7;
            border-bottom: 2px solid #00ffe7;
        }

        .scrolling-content {
            display: inline-block;
            padding-left: 100%;
            animation: scroll-text 15s linear infinite;
            font-size: 1.3em;
            color: #00ffe7;
        }

        @keyframes scroll-text {
            0% { transform: translateX(0%); }
            100% { transform: translateX(-100%); }
        }

        /* NEW: Styles for featured partners - Adjusted for side-by-side across all screen sizes */
        .featured-partners {
            display: flex; /* Enables flexbox for horizontal layout */
            justify-content: center; /* Centers the logos horizontally */
            align-items: center; /* Vertically aligns items in the center */
            gap: 40px; /* Space between the two logos */
            margin: 30px auto;
            padding: 0 20px;
            max-width: 600px; /* Adjust as needed for logo size and spacing */
            flex-wrap: wrap; /* Allows logos to wrap to the next line if space is too narrow */
        }

        .featured-partners img {
            width: 150px; /* Larger size */
            height: auto;
            object-fit: contain;
            opacity: 0.9;
            border-radius: 15px;
            box-shadow: 0 0 10px rgba(0, 255, 231, 0.4);
            transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
        }

        .featured-partners img:hover {
            transform: scale(1.1);
            opacity: 1;
            box-shadow: 0 0 20px #ff4fd8, 0 0 30px rgba(255, 79, 216, 0.6);
        }
        /* END NEW */

        * {
            box-sizing: border-box;
        }

        .channel-selector-text {
            text-align: center;
            font-size: 1.6em;
            margin: 2vh 0 1vh;
            color: #ff4fd8;
            padding: 0 5vw;
        }

        .channel-selection {
            text-align: center;
            margin-bottom: 3vh;
            padding: 0 5vw;
        }

        select {
            padding: 0.5em 1em;
            font-size: 1.1em;
            background: #111;
            color: #0ff;
            border: 2px solid #0ff;
            border-radius: 15px;
            outline: none;
            transition: 0.3s;
            text-align: center;
            box-shadow: 0 0 10px #0ff;
            width: 100%;
            max-width: 400px;
            margin: 0 auto;
            display: block;
        }

        select:hover {
            background: #1f0037;
            color: #fff;
            box-shadow: 0 0 15px #ff4fd8;
        }

        .player-container {
            position: relative;
            width: 90%;
            max-width: 1000px;
            aspect-ratio: 16 / 9;
            margin: 0 auto 40px;
            border: 4px solid;
            border-radius: 20px;
            overflow: hidden;
            background: #000;
            animation: borderPulseUnique 4s ease-in-out infinite;
        }

        @keyframes borderPulseUnique {
            0% { border-color: #ff4fd8; box-shadow: 0 0 15px #ff4fd8; }
            25% { border-color: #00ffe7; box-shadow: 0 0 30px #00ffe7; }
            50% { border-color: #ff4fd8; box-shadow: 0 0 15px #ff4fd8; }
            75% { border-color: #f7ff00; box-shadow: 0 0 30px #f7ff00; }
            100% { border-color: #ff4fd8; box-shadow: 0 0 15px #ff4fd8; }
        }

        .player-container iframe,
        .player-container video,
        #placeholder-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .player-container video::-webkit-media-controls-timeline,
        .player-container video::-webkit-media-controls-current-time-display,
        .player-container video::-webkit-media-controls-time-remaining-display,
        .player-container video::-webkit-media-controls-enclosure {
            display: none !important;
        }
        .player-container video::--moz-range-track,
        .player-container video::--moz-range-thumb {
            display: none !important;
        }
        .player-container video::-ms-fill-lower,
        .player-container video::-ms-fill-upper,
        .player-container video::-ms-thumb {
            display: none !important;
        }

        .unmute-button {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid #00ffe7;
            border-radius: 10px;
            padding: 10px 15px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            z-index: 101;
            font-size: 1.2em;
            color: #fff;
            box-shadow: 0 0 10px rgba(0, 255, 231, 0.5);
            transition: background 0.3s ease, border-color 0.3s ease, opacity 0.3s ease, visibility 0.3s ease;
            opacity: 1; /* Default to visible */
            visibility: visible; /* Default to visible */
        }

        .unmute-button.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none; /* Make it non-clickable when hidden */
        }

        .unmute-button:hover {
            background: rgba(0, 0, 0, 0.9);
            border-color: #ff4fd8;
            box-shadow: 0 0 15px rgba(255, 79, 216, 0.7);
        }

        .unmute-button #speaker-icon {
            font-size: 1.8em;
            line-height: 1;
        }

        .unmute-button .unmute-text {
            font-size: 0.8em;
            font-weight: 600;
            text-transform: uppercase;
        }

        .live-stamp {
            position: absolute;
            top: 5px;
            left: 5px;
            background: #ff003c;
            color: white;
            padding: 8px 12px;
            font-weight: bold;
            font-size: 0.9em;
            border-radius: 5px;
            z-index: 10;
            box-shadow: 0 0 10px #ff003c;
        }

        .loading-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.5em;
            background: rgba(0, 0, 0, 0.85);
            color: #ffcc00;
            padding: 15px 30px;
            border-radius: 12px;
            display: none;
            z-index: 15;
            text-align: center;
            animation: glowLoader 1.5s infinite alternate;
        }

        @keyframes glowLoader {
            0% { box-shadow: 0 0 5px #ffcc00; }
            100% { box-shadow: 0 0 15px #ffcc00; }
        }

        .logo-overlay {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 60px;
            height: auto;
            opacity: 0.85;
            z-index: 12;
        }

        .player-scroll-text {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            overflow: hidden;
            white-space: nowrap;
            padding: 8px 0;
            background: rgba(0, 0, 0, 0.7); /* Semi-transparent black background */
            border-top: 1px solid #00ffe7; /* Thin border */
            display: none; /* Hidden by default, shown by JS when channel is selected */
            z-index: 100;
            font-size: 0.9em;
            color: #fff;
            text-align: center; /* Center content within the scrolling area */
        }

        .player-scrolling-content {
            display: inline-block;
            padding-left: 100%;
            animation: player-scroll-animation 25s linear infinite; /* Slower speed for player text */
            color: #ffcc00; /* Bright yellow for pop */
            text-shadow: 0 0 5px #ffcc00; /* Small glow */
            font-weight: 600; /* Slightly bolder */
        }

        @keyframes player-scroll-animation {
            0% { transform: translateX(0%); }
            100% { transform: translateX(-100%); }
        }

        .partner-logos-container { /* Kept for other potential logos at the bottom */
            display: flex;
            justify-content: center;
            margin: 40px auto;
            padding: 0 20px;
            max-width: 1200px;
        }

        .partner-logos { /* Kept for other potential logos at the bottom */
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 0;
            width: 100%;
            justify-items: center;
            align-items: center;
        }

        .partner-logos img { /* Kept for other potential logos at the bottom */
            width: 100%;
            max-width: 90px;
            height: auto;
            object-fit: contain;
            opacity: 0.8;
            transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            border-radius: 8px;
            box-shadow: 0 0 5px rgba(255, 255, 255, 0.1);
        }

        .partner-logos img:hover { /* Kept for other potential logos at the bottom */
            transform: scale(1.1);
            opacity: 1;
            box-shadow: 0 0 15px #00ffe7,
                        0 0 25px rgba(0, 255, 231, 0.4);
        }

        audio {
            display: none;
        }

        footer {
            padding: 40px 20px;
            color: #aaa;
            font-family: 'Poppins', sans-serif;
        }

        .footer-section {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
            align-items: flex-start;
            max-width: 1200px;
            margin: 0 auto;
            gap: 20px;
            padding: 0 15px;
        }

        .footer-column {
            flex: 1 1 auto;
            min-width: 280px;
            margin: 0;
            padding: 10px;
        }

        .footer-column h2 {
            color: #ff004f;
            margin-bottom: 10px;
            font-size: 1.75rem;
            font-weight: 600;
            letter-spacing: 0.05em;
        }

        .footer-column h3, .footer-column h4 {
            color: #ff004f;
            margin-top: 15px;
            margin-bottom: 5px;
            font-size: 1.25rem;
            font-weight: 600;
            letter-spacing: 0.03em;
        }

        .footer-column p {
            font-size: 0.9rem;
            line-height: 1.7;
            color: #e0e0e0;
            letter-spacing: 0.02em;
            text-align: justify;
            margin-bottom: 1.5em;
        }

        .footer-column a {
            color: #ffcc00;
            text-decoration: none;
            font-weight: 400;
            transition: color 0.3s ease;
        }

        .footer-column a:hover {
            text-decoration: underline;
            color: #fff;
        }

        .facebook-follow {
            text-align: center;
            margin-top: 40px;
            margin-bottom: 25px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .facebook-follow a {
            display: inline-flex;
            align-items: center;
            color: #fff;
            font-size: 1.2em;
            text-decoration: none;
            background: #3b5998;
            padding: 10px 20px;
            border-radius: 5px;
            transition: background 0.3s ease;
        }

        .facebook-follow a:hover {
            background: #2d4373;
        }

        .facebook-follow img {
            width: 30px;
            height: 30px;
            margin-right: 10px;
            filter: hue-rotate(300deg) saturate(500%) brightness(120%) contrast(100%);
            box-shadow: 0 0 10px #ff0000,
                        0 0 20px rgba(255, 0, 0, 0.4);
            transition: filter 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
        }

        .facebook-follow a:hover img {
            box-shadow: 0 0 15px #ff4500,
                        0 0 25px rgba(255, 69, 0, 0.6);
            filter: hue-rotate(305deg) saturate(600%) brightness(130%) contrast(100%);
        }

        .copyright {
            text-align: center;
            color: #b0b0b0;
            margin-top: 20px;
            font-size: 0.8rem;
            letter-spacing: 0.03em;
        }

        @media (max-width: 768px) {
            .footer-section {
                flex-direction: column;
                align-items: center;
                gap: 30px;
            }

            .footer-column {
                min-width: unset;
                width: 90%;
                text-align: left;
            }

            .header-content .subtitle {
                font-size: 1.5em;
            }

            .featured-partners {
                gap: 20px;
                max-width: 90%;
            }

            .featured-partners img {
                width: 100px; /* Adjust size for smaller screens to ensure they fit side-by-side */
            }
        }

        @media (max-width: 480px) {
            .footer-column {
                padding: 5px;
            }
            .header-content .subtitle {
                font-size: 1.2em;
            }
            .featured-partners {
                gap: 15px;
            }
            .featured-partners img {
                width: 80px; /* Further adjust size to keep them side-by-side on very small screens */
            }
        }
    </style>
</head>
<body>
    <audio autoplay loop>
        <source src="https://files.freemusicarchive.org/storage-freemusicarchive-org/music/no_curator/Monplaisir/HiFi_City_Tales/Monplaisir_-_05_-_Your_Lovely_Face.mp3" type="audio/mp3">
    </audio>

    <div class="header-content">
        <img src="/logo.png" alt="MSTV Logo" class="mstv-logo">
        <div class="subtitle">Home of entertainment, away from home.</div>
    </div>

    <div class="scrolling-text">
        <div class="scrolling-content">Welcome to MSTV India - Refresh the webpage to auto-tune channels!</div>
    </div>

    <div class="featured-partners">
        <img src="logo.img/images.png" alt="Partner Logo 1">
        <img src="logo.img/images%20(1).jpeg" alt="Partner Logo 2">
    </div>

    <div class="channel-selector-text">Select Channel</div>
    <div class="channel-selection">
        <select id="channel-select">
            <option value="">ðŸ‘‰ðŸ“ºðŸ“ºðŸ“º</option>
            </select>
    </div>

    <div class="player-container" id="player-container">
        <iframe id="media-player" allow="autoplay; encrypted-media; picture-in-picture" sandbox="allow-scripts allow-same-origin allow-presentation"></iframe>
        <video id="video-player" autoplay muted playsinline controlsList="nodownload nofullscreen noremote playback" disablePictureInPicture></video>
        <img id="placeholder-image" src="Design-Studio-2025-01-22 (1).png" alt="Stream Placeholder" />

        <div class="live-stamp">MSTV NETWORK</div>
        <div class="loading-indicator" id="loading">Loading stream...</div>
        <img src="/logo.png" class="logo-overlay" alt="MSTV Logo" />

        <div class="unmute-button" id="unmute-button">
            <span id="speaker-icon">ðŸ”‡</span>
            <span class="unmute-text">Unmute</span>
        </div>

        <div class="player-scroll-text" id="player-scroll-text">
            <div class="player-scrolling-content" id="player-scroll-content"></div>
        </div>
    </div>

    <div class="partner-logos-container">
        <div class="partner-logos">
            </div>
    </div>
    <div class="facebook-follow">
        <a href="https://www.facebook.com/share/16VZyWirq4/" target="_blank">
            <img src="https://upload.wikimedia.org/wikipedia/commons/5/51/Facebook_f_logo_%282019%29.svg" alt="Facebook Icon" />
            Follow us on Facebook
        </a>
    </div>

    <footer>
        <div class="footer-section">
            <div class="footer-column">
                <h2>About MSTV</h2>
                <p id="about-mstv-text"></p>

                <h3>Disclaimer</h3>
                <p id="disclaimer-text"></p>
                <h4>Terms of services</h4>
                <p id="terms-of-service-text"></p>
            </div>
            <div class="footer-column">
                <h2>Contact</h2>
                <p><span id="contact-email"></span></p>
                <p><span id="contact-phone"></span></p>
            </div>
        </div>

        <div class="copyright" id="copyright-text"></div>
    </footer>

    <script>
        const select = document.getElementById('channel-select');
        const videoPlayer = document.getElementById('video-player');
        const iframePlayer = document.getElementById('media-player');
        const placeholder = document.getElementById('placeholder-image');
        const loading = document.getElementById('loading');
        const unmuteButton = document.getElementById('unmute-button');
        const speakerIcon = document.getElementById('speaker-icon');
        const playerScrollText = document.getElementById('player-scroll-text');
        const playerScrollContent = document.getElementById('player-scroll-content');

        // >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
        // YOU CAN CHANGE THIS TEXT!
        // If left as an empty string "", it will default to "Now Playing: [Channel Name]"
        const userDefinedPlayerScrollMessage = "";
        // >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

        // *** IMPORTANT: Path to your config.json file ***
        // This assumes config.json is in the same directory as index.html
        const CONFIG_URL = "/config.json";
        // If it was in a subfolder called 'mstv', it would be "/mstv/config.json"
        // But your 404 error indicated it's likely at the root.

        let currentConfigData = null; // To store the current configuration
        let hlsInstance = null; // Keep hlsInstance for HLS.js management

        function showLoading(show) {
            loading.style.display = show ? 'block' : 'none';
        }

        // Modified updateSpeakerIcon function
        function updateSpeakerIcon() {
            if (videoPlayer.muted) {
                speakerIcon.textContent = 'ðŸ”‡';
                unmuteButton.classList.remove('hidden'); // Show the button when muted
            } else {
                unmuteButton.classList.add('hidden'); // Hide the button completely when unmuted
            }
        }

        function setPlayerScrollingText(show, text = "") {
            playerScrollText.style.display = show ? 'block' : 'none';
            playerScrollContent.textContent = text; // This sets the content
        }

        unmuteButton.addEventListener('click', () => {
            if (videoPlayer.style.display === 'block') {
                videoPlayer.muted = !videoPlayer.muted;
            }
        });

        videoPlayer.addEventListener('volumechange', updateSpeakerIcon);

        // Function to fetch the config file
        async function fetchAndApplyConfig() {
            try {
                const response = await fetch(CONFIG_URL);
                if (!response.ok) {
                    console.error(`Failed to fetch config.json: ${response.status} ${response.statusText}`);
                    return;
                }
                const newConfigData = await response.json();

                // Check if the new config is different from the current one
                if (JSON.stringify(newConfigData) !== JSON.stringify(currentConfigData)) {
                    console.log("Configuration updated! Applying changes...");
                    currentConfigData = newConfigData; // Update the current config

                    // --- Apply changes to the HTML based on newConfigData ---

                    // 1. Update Channel Selector
                    const currentSelectedValue = select.value; // Remember what was selected
                    select.innerHTML = '<option value="">ðŸ‘‰ðŸ“ºðŸ“ºðŸ“º</option>'; // Clear current options
                    if (newConfigData.channels && Array.isArray(newConfigData.channels)) {
                        newConfigData.channels.forEach(channel => {
                            const option = document.createElement('option');
                            option.value = channel.url;
                            option.textContent = channel.name;
                            select.appendChild(option);
                        });
                    }
                    // Restore previous selection if it's still in the new list, otherwise reset
                    if (currentSelectedValue && newConfigData.channels && newConfigData.channels.some(c => c.url === currentSelectedValue)) {
                        select.value = currentSelectedValue;
                    } else {
                        select.value = ""; // Reset if selected channel is no longer available
                    }

                    // 2. Update Main Scrolling Text
                    const mainScrollingContent = document.querySelector('.scrolling-content');
                    if (mainScrollingContent && newConfigData.scrollingText) {
                        mainScrollingContent.textContent = newConfigData.scrollingText;
                    }

                    // 3. Update Footer Content
                    const footerAbout = document.getElementById('about-mstv-text');
                    if (footerAbout && newConfigData.footerAboutMSTV) {
                        footerAbout.textContent = newConfigData.footerAboutMSTV;
                    }
                    const footerDisclaimer = document.getElementById('disclaimer-text');
                    if (footerDisclaimer && newConfigData.footerDisclaimer) {
                        footerDisclaimer.textContent = newConfigData.footerDisclaimer;
                    }
                    const footerTerms = document.getElementById('terms-of-service-text');
                    if (footerTerms && newConfigData.footerTermsOfService) {
                        footerTerms.textContent = newConfigData.footerTermsOfService;
                    }
                    const contactEmail = document.getElementById('contact-email');
                    if (contactEmail && newConfigData.contactEmail) {
                        contactEmail.textContent = 'Email: ' + newConfigData.contactEmail;
                    }
                    const contactPhone = document.getElementById('contact-phone');
                    if (contactPhone && newConfigData.contactPhone) {
                        contactPhone.textContent = 'Phone: ' + newConfigData.contactPhone;
                    }

                    // Copyright Text
                    const copyrightDiv = document.getElementById('copyright-text');
                    if (copyrightDiv && newConfigData.copyrightText) {
                        copyrightDiv.textContent = newConfigData.copyrightText;
                    }

                    // --- End Apply changes ---
                } else {
                    console.log("Config not changed.");
                }
            } catch (error) {
                console.error("Error fetching or parsing config.json:", error);
            }
        }

        // Call fetchAndApplyConfig immediately when the page loads
        document.addEventListener('DOMContentLoaded', fetchAndApplyConfig);

        // Set up polling: fetch and apply config every 30 seconds
        setInterval(fetchAndApplyConfig, 30000); // 30000 milliseconds = 30 seconds

        select.addEventListener('change', () => {
            const url = select.value;
            const channelName = select.options[select.selectedIndex].text;
            showLoading(true);
            setPlayerScrollingText(false); // Hide scrolling text initially for any change
            unmuteButton.classList.add('hidden'); // Hide unmute button on channel change (before potential show)


            videoPlayer.pause();
            if (hlsInstance) {
                hlsInstance.destroy();
                hlsInstance = null;
            }
            videoPlayer.removeAttribute('src');
            videoPlayer.load();

            iframePlayer.src = '';
            placeholder.style.display = 'none';

            const isM3U8 = url.includes('.m3u8');
            const isIframe = url.includes('https://www.youtube.com/embed/fB6Z4q01uFU?si=Kz23yTT5MeuNAE-l&autoplay=1&controls=0') || url.includes('youtube-nocookie.com/embed') || url.includes('twitch.tv') || url.includes('.html') || url.includes('embed');

            // Determine the text for the player scroll based on userDefinedPlayerScrollMessage
            const scrollMessage = userDefinedPlayerScrollMessage || `Now Playing: ${channelName}`;


            if (isM3U8) {
                if (Hls.isSupported()) {
                    videoPlayer.style.display = 'block';
                    iframePlayer.style.display = 'none';

                    hlsInstance = new Hls();
                    hlsInstance.loadSource(url);
                    hlsInstance.attachMedia(videoPlayer);
                    hlsInstance.on(Hls.Events.MANIFEST_PARSED, function() {
                        videoPlayer.muted = true; // Ensure it starts muted
                        videoPlayer.autoplay = true;
                        videoPlayer.play().then(() => {
                            showLoading(false);
                            updateSpeakerIcon(); // Show if still muted, hide if unmuted
                            setPlayerScrollingText(true, scrollMessage); // Using the determined scroll message
                        }).catch(e => {
                            console.error("Video playback failed (HLS):", e);
                            alert("Playback failed. This stream might not be available or your device has autoplay restrictions.");
                            showLoading(false);
                            unmuteButton.classList.add('hidden'); // Hide on error
                            placeholder.style.display = 'block';
                            setPlayerScrollingText(false);
                        });
                    });
                    hlsInstance.on(Hls.Events.ERROR, function (event, data) {
                        console.error('HLS.js error:', data);
                        if (data.fatal) {
                            switch(data.type) {
                                case Hls.ErrorTypes.NETWORK_ERROR:
                                    console.error('fatal network error encountered, try to recover');
                                    hlsInstance.startLoad();
                                    break;
                                case Hls.ErrorTypes.MEDIA_ERROR:
                                    console.error('fatal media error encountered, try to recover');
                                    hlsInstance.recoverMediaError();
                                    break;
                                default:
                                    hlsInstance.destroy();
                                    showLoading(false);
                                    alert("Stream error: " + data.details + ". Please try another channel.");
                                    placeholder.style.display = 'block';
                                    unmuteButton.classList.add('hidden'); // Hide on error
                                    setPlayerScrollingText(false);
                                    break;
                            }
                        }
                    });

                } else if (videoPlayer.canPlayType('application/vnd.apple.mpegurl')) {
                    videoPlayer.style.display = 'block';
                    iframePlayer.style.display = 'none';
                    videoPlayer.src = url;
                    videoPlayer.muted = true; // Ensure it starts muted
                    videoPlayer.autoplay = true;
                    videoPlayer.play().then(() => {
                        showLoading(false);
                        updateSpeakerIcon(); // Show if still muted, hide if unmuted
                        setPlayerScrollingText(true, scrollMessage); // Using the determined scroll message
                    }).catch(e => {
                        console.error("Video playback failed (Native HLS):", e);
                        alert("Playback failed. This stream might not be available or your device has autoplay restrictions.");
                        showLoading(false);
                        unmuteButton.classList.add('hidden'); // Hide on error
                        placeholder.style.display = 'block';
                        setPlayerScrollingText(false);
                    });
                } else {
                    alert('Your browser does not support HLS streaming. Please try another browser (e.g., Safari on iOS/macOS or Chrome on Android).');
                    showLoading(false);
                    placeholder.style.display = 'block';
                    unmuteButton.classList.add('hidden'); // Hide if HLS not supported
                    setPlayerScrollingText(false);
                }
            } else if (isIframe) {
                iframePlayer.style.display = 'block';
                videoPlayer.style.display = 'none';
                unmuteButton.classList.add('hidden'); // Always hide unmute button for iframes

                iframePlayer.src = url;

                iframePlayer.onload = () => {
                    showLoading(false);
                    setPlayerScrollingText(true, scrollMessage); // Using the determined scroll message
                };
                iframePlayer.onerror = () => {
                    console.error("Iframe failed to load.");
                    showLoading(false);
                    alert("The embedded content could not be loaded. It might be blocked or unavailable.");
                    placeholder.style.display = 'block';
                    setPlayerScrollingText(false);
                };
            } else { // Direct video (e.g., mp4)
                videoPlayer.style.display = 'block';
                iframePlayer.style.display = 'none';
                videoPlayer.src = url;
                videoPlayer.muted = true; // Ensure it starts muted
                videoPlayer.autoplay = true;
                videoPlayer.play().then(() => {
                    showLoading(false);
                    updateSpeakerIcon(); // Show if still muted, hide if unmuted
                    setPlayerScrollingText(true, scrollMessage); // Using the determined scroll message
                }).catch((error) => {
                    console.error("Video playback failed (direct video):", error);
                    showLoading(false);
                    alert("Playback failed. This video format might not be supported or autoplay is blocked.");
                    placeholder.style.display = 'block';
                    unmuteButton.classList.add('hidden'); // Hide on error
                    setPlayerScrollingText(false);
                });
            }
        });
    </script>
</body>
</html>
