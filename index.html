<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="description" content="MSTV Network offers a variety of live TV channels including music, movies, and more. Watch your favorite channels online for free.">
    <meta name="keywords" content="live TV, MSTV Network, free TV, live channels, streaming, music, bollywood, saga music">
    <meta name="robots" content="index, follow">
    <meta property="og:title" content="MSTV Network">
    <meta property="og:description" content="Stream live TV channels including music, movies, and more on MSTV Network.">
    <meta property="og:image" content="https://raw.githubusercontent.com/mstvnetwork/mstv2/refs/heads/main/Design-Studio-2025-01-20%20(2).png">
    <meta property="og:url" content="https://mstvnet.netlify.app/">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="MSTV Network">
    <meta name="twitter:description" content="Stream live TV channels including music, movies, and more on MSTV Network.">
    <meta name="twitter:image" content="https://raw.githubusercontent.com/mstvnetwork/mstv2/refs/heads/main/Design-Studio-2025-01-20%20(2).png">
    <meta name="twitter:url" content="https://mstvnet.netlify.app/">

    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebPage",
        "name": "MSTV Network",
        "description": "Stream live TV channels including music, movies and more.",
        "url": "https://yourwebsite.com",
        "publisher": {
            "@type": "Organization",
            "name": "MSTV Network",
            "logo": {
                "@type": "ImageObject",
                "url": "https://raw.githubusercontent.com/mstvnetwork/mstv2/refs/heads/main/Design-Studio-2025-01-20%20(2).png"
            }
        }
    }
    </script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-HJFN0N9L63"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-HJFN0N9L63');
</script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" integrity="sha512-1ycn6IcaQQ40/MKBW2W4Rhis/DbILU74C1vSrLJxCq57o941Ym01SwNsOMqvEbFlcgUa6xLiPY/NS5R+E6ztJQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <link href="https://vjs.zencdn.net/8.10.0/video-js.css" rel="stylesheet" />
    <title>MSTV INDIA</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        html {
            font-size: 16px;
            /* Changed from gradient to solid black */
            background: #000;
            min-height: 100%;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Poppins', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            /* General text color for contrast */
            color: #E0E0E0; /* A soft grey that's easy on the eyes on black */
            width: 100%;
            min-height: 100vh;
            overflow-x: hidden;
            background-color: #000; /* Ensure body itself is black */
        }

        .title-3d {
            font-size: 3em;
            text-align: center;
            margin-top: 30px;
            /* Vibrant neon blue */
            color: #00FFFF; /* Cyan */
            /* Stronger glow for popping */
            text-shadow: 0 0 15px #00FFFF, 0 0 30px #00FFFF, 0 0 45px rgba(0, 255, 255, 0.7);
            animation: glow 2s infinite alternate;
        }

        @keyframes glow {
            0% { text-shadow: 0 0 15px #00FFFF, 0 0 30px #00FFFF; }
            100% { text-shadow: 0 0 25px #00FFFF, 0 0 45px #00FFFF, 0 0 60px rgba(0, 255, 255, 0.8); }
        }

        /* Viewer Count Styling - adjusted for black background */
        .viewer-count-display {
            text-align: center;
            font-size: 1.5em;
            margin-top: 10px;
            margin-bottom: 20px;
            /* Vibrant neon pink */
            color: #FF00FF; /* Fuchsia */
            /* Stronger glow */
            text-shadow: 0 0 10px #FF00FF, 0 0 20px rgba(255, 0, 255, 0.7), 0 0 30px rgba(255, 0, 255, 0.5);
            font-weight: 600;
            animation: viewerGlow 1.5s infinite alternate;
        }

        @keyframes viewerGlow {
            0% { text-shadow: 0 0 10px #FF00FF, 0 0 20px rgba(255, 0, 255, 0.7); }
            100% { text-shadow: 0 0 15px #FF00FF, 0 0 30px rgba(255, 0, 255, 0.9); }
        }

        .scrolling-text {
            overflow: hidden;
            white-space: nowrap;
            padding: 12px 0;
            margin: 20px 0;
            /* Semi-transparent glow effect for the background strip */
            background: rgba(0, 255, 255, 0.1); /* Light cyan background */
            border-top: 2px solid #00FFFF; /* Cyan border */
            border-bottom: 2px solid #00FFFF; /* Cyan border */
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.5); /* Matching glow */
        }

        .scrolling-content {
            display: inline-block;
            padding-left: 100%;
            animation: scroll-text 15s linear infinite;
            font-size: 1.3em;
            color: #00FFFF; /* Text color matching cyan */
            text-shadow: 0 0 5px #00FFFF;
        }

        @keyframes scroll-text {
            0% { transform: translateX(0%); }
            100% { transform: translateX(-100%); }
        }

        * {
            box-sizing: border-box;
        }

        .channel-selector-text {
            text-align: center;
            font-size: 1.6em;
            margin: 2vh 0 1vh;
            /* Vibrant neon pink for selector text */
            color: #FF00FF;
            text-shadow: 0 0 8px #FF00FF;
            padding: 0 5vw;
        }

        .channel-selection {
            margin-bottom: 3vh;
            padding: 0 5vw;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        select {
            padding: 0.5em 1em;
            font-size: 1.1em;
            background: #111; /* Dark background */
            color: #00FFFF; /* Cyan text */
            border: 2px solid #00FFFF; /* Cyan border */
            border-radius: 15px;
            outline: none;
            transition: 0.3s;
            text-align: center;
            /* Stronger glow for select box */
            box-shadow: 0 0 15px #00FFFF, 0 0 25px rgba(0, 255, 255, 0.5);
            width: 100%;
            max-width: 400px;
            display: block;
        }

        select:hover {
            background: #222; /* Slightly lighter on hover */
            color: #FF00FF; /* Fuchsia on hover */
            border-color: #FF00FF; /* Fuchsia border on hover */
            box-shadow: 0 0 20px #FF00FF, 0 0 30px rgba(255, 0, 255, 0.7);
        }

        .player-container {
            position: relative;
            width: 90%;
            max-width: 1000px;
            aspect-ratio: 16 / 9;
            margin: 0 auto 40px;
            border: 4px solid;
            border-radius: 20px;
            overflow: hidden;
            background: #000; /* Keep player background black */
            /* Adjusted borderPulseUnique for new colors */
            animation: borderPulseUnique 4s ease-in-out infinite;
        }

        @keyframes borderPulseUnique {
            0% { border-color: #FF00FF; box-shadow: 0 0 20px #FF00FF; } /* Fuchsia */
            25% { border-color: #00FFFF; box-shadow: 0 0 35px #00FFFF; } /* Cyan */
            50% { border-color: #FF00FF; box-shadow: 0 0 20px #FF00FF; }
            75% { border-color: #FFFF00; box-shadow: 0 0 35px #FFFF00; } /* Yellow */
            100% { border-color: #FF00FF; box-shadow: 0 0 20px #FF00FF; }
        }

        /* Ensure Video.js player and iframe fill the container */
        .player-container .video-js,
        .player-container #media-iframe-player {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        #placeholder-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover; /* Ensure image covers the area */
        }

        .unmute-button {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8); /* Slightly more opaque */
            border: 2px solid #00FFFF; /* Cyan border */
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            z-index: 101;
            font-size: 1.8em;
            color: #fff; /* White icon */
            /* Stronger glow */
            box-shadow: 0 0 15px #00FFFF, 0 0 25px rgba(0, 255, 255, 0.7);
            transition: background 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .unmute-button:hover {
            background: rgba(0, 0, 0, 0.95);
            border-color: #FF00FF; /* Fuchsia on hover */
            box-shadow: 0 0 20px #FF00FF, 0 0 35px rgba(255, 0, 255, 0.8);
        }

        .live-stamp {
            position: absolute;
            top: 10px; /* Slightly more space */
            left: 10px; /* Slightly more space */
            background: #FF0000; /* Bright red for LIVE */
            color: white;
            padding: 8px 12px;
            font-weight: bold;
            font-size: 1em; /* Slightly larger */
            border-radius: 5px;
            z-index: 10;
            /* Stronger glow */
            box-shadow: 0 0 15px #FF0000, 0 0 25px rgba(255, 0, 0, 0.7);
        }

        .loading-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.5em;
            background: rgba(0, 0, 0, 0.9); /* More opaque */
            color: #FFFF00; /* Bright yellow */
            padding: 15px 30px;
            border-radius: 12px;
            display: none;
            z-index: 15;
            text-align: center;
            /* Stronger glow */
            animation: glowLoader 1.5s infinite alternate;
        }

        @keyframes glowLoader {
            0% { box-shadow: 0 0 10px #FFFF00; }
            100% { box-shadow: 0 0 25px #FFFF00, 0 0 40px rgba(255, 255, 0, 0.7); }
        }

        .logo-overlay {
            position: absolute;
            bottom: 10px;
            right: 10px;
            width: 70px; /* Slightly larger */
            height: auto;
            opacity: 0.95; /* More visible */
            z-index: 12;
            /* Subtle glow for logo */
            filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.5)); /* White glow */
        }

        .partner-logos {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 40px; /* More space */
            margin: 60px auto; /* More margin */
            padding: 0 20px;
            max-width: 1000px;
        }

        .partner-logos img {
            max-width: 200px; /* Larger logos */
            height: auto;
            opacity: 0.7; /* Slightly transparent by default */
            transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            border-radius: 12px; /* More rounded corners */
            box-shadow: 0 0 8px rgba(255, 255, 255, 0.1);
        }

        .partner-logos img:hover {
            transform: scale(1.15); /* More enlarge on hover */
            opacity: 1; /* Fully opaque on hover */
            /* Intense glow on hover */
            box-shadow: 0 0 25px #00FFFF, /* Cyan glow */
                        0 0 40px rgba(0, 255, 255, 0.6);
        }

        audio {
            display: none;
        }

        footer {
            padding: 40px 20px;
            color: #B0B0B0; /* Slightly darker grey for general footer text */
            font-family: 'Poppins', sans-serif;
            background-color: #000; /* Ensure footer background is black */
        }

        .footer-section {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
            align-items: flex-start;
            max-width: 1200px;
            margin: 0 auto;
            gap: 20px;
            padding: 0 15px;
        }

        .footer-column {
            flex: 1 1 auto;
            min-width: 280px;
            margin: 0;
            padding: 10px;
        }

        .footer-column h2 {
            /* Vibrant orange for footer headings */
            color: #FFA500; /* Orange */
            text-shadow: 0 0 8px #FFA500;
            margin-bottom: 10px;
            font-size: 1.75rem;
            font-weight: 600;
            letter-spacing: 0.05em;
        }

        .footer-column h3, .footer-column h4 {
            /* Vibrant orange for sub-headings */
            color: #FFA500;
            text-shadow: 0 0 5px #FFA500;
            margin-top: 15px;
            margin-bottom: 5px;
            font-size: 1.25rem;
            font-weight: 600;
            letter-spacing: 0.03em;
        }

        .footer-column p {
            font-size: 0.9rem;
            line-height: 1.7;
            color: #E0E0E0; /* Consistent light grey */
            letter-spacing: 0.02em;
            text-align: justify;
            margin-bottom: 1.5em;
        }

        .footer-column a {
            color: #FFFF00; /* Bright yellow for links */
            text-decoration: none;
            font-weight: 400;
            transition: color 0.3s ease, text-shadow 0.3s ease;
        }

        .footer-column a:hover {
            text-decoration: underline;
            color: #00FFFF; /* Cyan on hover */
            text-shadow: 0 0 10px #00FFFF;
        }

        .facebook-follow {
            text-align: center;
            margin-top: 40px;
            margin-bottom: 25px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .facebook-follow a {
            display: inline-flex;
            align-items: center;
            color: #fff;
            font-size: 1.2em;
            text-decoration: none;
            background: #3b5998; /* Original FB blue, but we'll filter it */
            padding: 10px 20px;
            border-radius: 5px;
            transition: background 0.3s ease;
            /* Added shadow to the button itself */
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        }

        .facebook-follow a:hover {
            background: #2d4373;
        }

        .facebook-follow img {
            width: 30px;
            height: 30px;
            margin-right: 10px;
            /* Adjust filter to make it a glowing purple/pink */
            filter: hue-rotate(270deg) saturate(300%) brightness(150%) contrast(100%);
            
            /* Keep the glowing box-shadow for pop */
            box-shadow: 0 0 12px #FF00FF, /* Fuchsia glow */
                        0 0 25px rgba(255, 0, 255, 0.5);
            
            transition: filter 0.3s ease-in-out, box-shadow 0.3s ease-in-out; 
        }

        .facebook-follow a:hover img {
            /* Adjust glow on hover to a slightly different color */
            box-shadow: 0 0 18px #00FFFF, /* Cyan glow on hover */
                        0 0 30px rgba(0, 255, 255, 0.7);
            
            /* Optional: Slightly adjust filter on hover for a subtle icon color change */
            filter: hue-rotate(280deg) saturate(350%) brightness(160%) contrast(100%);
        }

        .copyright {
            text-align: center;
            color: #909090; /* A darker grey for copyright, less distracting */
            margin-top: 20px;
            font-size: 0.8rem;
            letter-spacing: 0.03em;
        }
        /* No changes needed for these if they are unused, but adjusted for consistency if they become visible */
        .status-display-container {
            margin: 20px auto;
            max-width: 800px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.5); /* Darker background */
            border-radius: 12px;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.4); /* Cyan glow */
            text-align: center;
            border: 1px solid rgba(0, 255, 255, 0.7);
        }

        #statusMessage {
            font-size: 1.1em;
            color: #00FFFF; /* Cyan */
            margin-bottom: 10px;
            text-shadow: 0 0 5px #00FFFF;
        }

        #rawDataDisplay {
            background-color: rgba(0, 0, 0, 0.6); /* More opaque */
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
            overflow-x: auto;
            text-align: left;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.9em;
            color: #FFD700; /* Gold-like for raw data */
            border: 1px solid rgba(255, 215, 0, 0.7);
            max-height: 200px;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
        }

        @media (max-width: 768px) {
            .footer-section {
                flex-direction: column;
                align-items: center;
                gap: 30px;
            }

            .footer-column {
                min-width: unset;
                width: 90%;
                text-align: left;
            }
        }

        @media (max-width: 480px) {
            .footer-column {
                padding: 5px;
                font-size: 0.8em; /* Slightly smaller on very small screens */
            }
            .title-3d {
                font-size: 2.2em;
            }
            .viewer-count-display {
                font-size: 1.2em;
            }
            .scrolling-content {
                font-size: 1em;
            }
            .channel-selector-text {
                font-size: 1.4em;
            }
            select {
                font-size: 1em;
            }
            .live-stamp {
                font-size: 0.8em;
                padding: 6px 10px;
            }
            .unmute-button {
                width: 45px;
                height: 45px;
                font-size: 1.6em;
            }
            .logo-overlay {
                width: 50px;
            }
        }
    </style>
</head>
<body>
    <div class="title-3d">MSTV INDIA</div>

    <div id="viewerCountDisplay" class="viewer-count-display">
        <span class="fas fa-eye"></span> Current Viewers: <span id="currentViewerCount"></span>
    </div>

    <div class="scrolling-text">
        <div class="scrolling-content">Welcome to MSTV India - Refresh the webpage to auto-tune channels!</div>
    </div>

    <div class="channel-selector-text">Select Channel</div>
    <div class="channel-selection">
        <select id="channel-select">
            <option value="">👉📺📺📺</option>
            </select>
    </div>

    <div class="player-container" id="player-container">
        <video id="video-player" class="video-js vjs-default-skin vjs-big-play-button" controls preload="auto" width="100%" height="100%"
            data-setup='{"autoplay": true, "muted": true, "liveui": true, "responsive": true, "fluid": true, "controlBar": {"liveDisplay": true}}'>
        </video>
        <iframe id="media-iframe-player" allow="autoplay; encrypted-media; picture-in-picture" sandbox="allow-scripts allow-same-origin allow-presentation"></iframe>
        
        <img id="placeholder-image" src="Design-Studio-2025-01-22 (1).png" alt="Stream Placeholder" />
        
        <div class="live-stamp">MSTV NETWORK</div>
        <div class="loading-indicator" id="loading">Loading stream...</div>
        <img src="/logo.png" class="logo-overlay" alt="MSTV Logo" />

        <div class="unmute-button" id="unmute-button">
            <span id="speaker-icon">🔇</span>
        </div>
    </div>

    <div class="partner-logos"> <img src="logo.img/images.png" alt="Partner Logo 1">
        <img src="logo.img/images (1).jpeg" alt="Partner Logo 2">
    </div>

    <div class="facebook-follow">
        <a href="https://www.facebook.com/share/16VZyWirq4/" target="_blank">
            <img src="https://upload.wikimedia.org/wikipedia/commons/5/51/Facebook_f_logo_%282019%29.svg" alt="Facebook Icon" />
            Follow us on Facebook
        </a>
    </div>

    <footer>
        <div class="footer-section">
            <div class="footer-column">
                <h2>About MSTV</h2>
                <p>MSTV Network is a non-profit platform offering free access to live TV channels, including entertainment, music, news, and more. We provide high-quality streaming to viewers worldwide, ensuring a diverse and engaging experience. Our mission is to make content from the Indian subcontinent accessible to everyone, fostering cultural exchange through free, reliable, and uninterrupted TV streaming.</p>

                <h3>Disclaimer</h3>
                <p>
                    MSTV Network provides access to publicly available channels from various sources on the internet for informational and entertainment purposes only. We do not control or guarantee the accuracy, availability, or legality of the content streamed. All content is provided "as is," and MSTV Network is not liable for any errors, interruptions, or damages arising from the use of our services. By using MSTV Network, you agree to comply with all applicable laws. For more details, please refer to our Terms of Service and Privacy Policy.
                </p>
                <h4>Terms of services</h4>
                <p>By using MSTV Network, you agree to comply with our terms of service...</p>
            </div>
            <div class="footer-column">
                <h2>Contact</h2>
                <p>Email: contact@mstvindia.com</p>
                <p>Phone: +001-305-242-4447 </p>
            </div>
        </div>

        <div class="copyright">© 2025 MSTV INDIA. All rights reserved.</div>
    </footer>

    <script src="https://vjs.zencdn.net/8.10.0/video.min.js"></script>
    <script src="https://unpkg.com/@videojs/http-streaming@3.9.0/dist/videojs-http-streaming.min.js"></script>

    <script>
        const select = document.getElementById('channel-select');
        const videoElement = document.getElementById('video-player');
        const iframePlayer = document.getElementById('media-iframe-player');
        const placeholder = document.getElementById('placeholder-image');
        const loading = document.getElementById('loading');
        const unmuteButton = document.getElementById('unmute-button');
        const speakerIcon = document.getElementById('speaker-icon');

        const viewerCountDisplay = document.getElementById('viewerCountDisplay');
        const currentViewerCountSpan = document.getElementById('currentViewerCount');

        let videoJsPlayer = null;
        let channelsData = [];
        let lastKnownJsonContent = null;

        const githubJsonUrl = 'channels.json';
        const pollingInterval = 5000;

        const minViewers = 500;
        const maxViewers = 2000;
        let currentViewers = Math.floor(Math.random() * (maxViewers - minViewers + 1)) + minViewers;
        const fluctuationAmount = 50;
        const updateInterval = 2000;

        // Initialize Video.js player once
        function initializeVideoJs() {
            if (!videoJsPlayer) {
                videoJsPlayer = videojs(videoElement, {
                    autoplay: true, 
                    muted: true,
                    liveui: true,
                    responsive: true,
                    fluid: true,
                    controls: true, 
                    controlBar: {
                        liveDisplay: true,
                    },
                    // *** START HLS.js (via videojs-http-streaming) CONFIGURATION FOR BUFFERING ***
                    html5: {
                        hls: {
                            // Forces the player to start at the lowest quality level (0 index).
                            // This gets the video playing fastest, then ABR will ramp up if bandwidth allows.
                            startLevel: 0, 

                            // The target amount of wall clock time (in seconds) that may be buffered ahead of the current time.
                            // Increased slightly for more stability, decreased from default for live.
                            maxBufferLength: 12, // seconds (Adjusted from 10 to 12 for slightly more buffer)

                            // The absolute maximum amount of wall clock time that may be buffered ahead.
                            // Provides a cap, allowing for a healthy buffer without excessive latency.
                            maxMaxBufferLength: 30, // seconds (Adjusted from 25 to 30 for slightly more buffer)

                            // Defines how many seconds away from the live edge the player attempts to stay.
                            // A value like 6-8s is common for balanced live latency and stability.
                            liveSyncDuration: 7, // seconds (Adjusted from 6 to 7)
                            
                            // Maximum acceptable latency for live streams. If exceeding, player tries to catch up.
                            // Gives the player a bit more room to recover from network hiccups before pausing.
                            liveMaxLatencyDuration: 15, // seconds (Adjusted from 12 to 15)

                            // Minimum bitrate (in bits per second) that HLS.js will try to maintain.
                            // If the network drops below this, it will proactively switch to a lower quality.
                            // Set to 100kbps (100,000 bps) as a floor. Adjust based on your lowest stream quality.
                            minAutoBitrate: 100000, 

                            // Number of retries for fragment loading before giving up.
                            // Increased to 6 from a typical default of 3 to tolerate more transient network issues.
                            fragLoadingMaxRetry: 6,

                            // Delay (in ms) before retrying a failed fragment load.
                            // Increased to 1500ms to give the network more time to recover between retries.
                            fragLoadingRetryDelay: 1500,

                            // Set to true if your HLS stream truly supports Low-Latency HLS (LL-HLS) features.
                            // Only enable if your source encoder is generating LL-HLS compatible streams (e.g., CMAF).
                            // Otherwise, keep it false as it can cause issues if not supported by the stream.
                            // lowLatencyMode: false, // Set to true ONLY if your streams are LL-HLS!
                            
                            // Keep false unless you need to limit quality based on player's pixel size.
                            // Usually, you want ABR to select based on bandwidth, not just visible size.
                            capLevelToPlayerSize: false, 

                            // Uncomment for verbose HLS.js debugging in the console (useful for diagnosing)
                            // debug: true, 
                        }
                    }
                    // *** END HLS.js (via videojs-http-streaming) CONFIGURATION ***
                }, function() {
                    console.log('Video.js player is ready!');
                    this.on('loadeddata', () => {
                        console.log('Video.js: loadeddata event - Hiding loading indicator.');
                        showLoading(false);
                    });
                    this.on('waiting', () => {
                        console.log('Video.js: waiting event - Showing loading indicator.');
                        showLoading(true);
                    });
                    this.on('playing', () => {
                        console.log('Video.js: playing event - Hiding loading indicator.');
                        showLoading(false);
                    });
                    this.on('error', (e) => {
                        console.error('Video.js error:', this.error());
                        showLoading(false);
                        placeholder.style.display = 'block';
                        videoElement.style.display = 'none'; // Hide player on error
                        iframePlayer.style.display = 'none'; // Ensure iframe is also hidden
                        unmuteButton.style.display = 'none';
                        const error = this.error();
                        if (error && error.code === 4) { // MEDIA_ERR_SRC_NOT_SUPPORTED
                            alert("This video format is not supported or the stream is unavailable. Please try another channel.");
                        } else {
                            alert("An error occurred during video playback. Please try again.");
                        }
                    });
                    this.on('volumechange', updateSpeakerIcon);
                    // Ensure initial mute state is reflected
                    updateSpeakerIcon();
                });
            }
        }

        function showLoading(show) {
            loading.style.display = show ? 'block' : 'none';
            // Always hide placeholder when loading or playing
            placeholder.style.display = 'none';
        }

        function updateSpeakerIcon() {
            if (videoJsPlayer && videoJsPlayer.muted()) {
                speakerIcon.textContent = '🔇';
                unmuteButton.style.display = 'flex';
            } else {
                speakerIcon.textContent = '🔊';
                unmuteButton.style.display = 'none';
            }
        }

        unmuteButton.addEventListener('click', () => {
            if (videoJsPlayer) {
                videoJsPlayer.muted(false);
                // Attempt to play after unmuting, as some browsers require it
                videoJsPlayer.play().catch(e => console.warn("Unmute and play failed, user interaction may be required:", e));
                updateSpeakerIcon();
            }
        });

        function resetPlayers() {
            console.log('Resetting players...');
            showLoading(true); // Show loading while resetting/switching

            // Hide all player types initially
            videoElement.style.display = 'none';
            iframePlayer.style.display = 'none';
            placeholder.style.display = 'none'; // Will be shown if nothing plays or on error

            // Stop and dispose Video.js player if it exists
            if (videoJsPlayer) {
                videoJsPlayer.pause();
                videoJsPlayer.reset(); // Clear current source and data
                console.log('Video.js player reset.');
            }

            // Clear iframe source
            iframePlayer.src = 'about:blank'; // Use about:blank to clear content without navigation issues
            unmuteButton.style.display = 'none'; // Hide unmute button until a video player is active
        }

        function playChannel(channel) {
            resetPlayers(); // Always reset before playing a new channel
            console.log('Attempting to play channel:', channel.name, 'Type:', channel.type, 'URL:', channel.url);

            if (channel.type === 'hls' || channel.type === 'mp4') {
                videoElement.style.display = 'block'; // Show Video.js player
                
                const source = {
                    src: channel.url,
                    type: channel.type === 'hls' ? 'application/x-mpegURL' : 'video/mp4'
                };

                videoJsPlayer.src(source);
                videoJsPlayer.muted(true); // Always start muted
                
                // Attempt to play. This promise can reject if autoplay is blocked.
                videoJsPlayer.play().then(() => {
                    console.log('Video.js play initiated successfully.');
                    // Loading indicator will be hidden by loadeddata/playing events
                    // Speaker icon will be updated by volumechange event
                }).catch(e => {
                    console.warn("Video.js initial play failed, likely autoplay blocked or network issue:", e);
                    // If autoplay is blocked, prompt user to unmute/play
                    showLoading(false); // Hide loading as it's not a loading issue
                    placeholder.style.display = 'block'; // Show placeholder if playback fails
                    videoElement.style.display = 'none'; // Hide Video.js player
                    unmuteButton.style.display = 'flex'; // Show unmute button to prompt interaction
                    speakerIcon.textContent = '🔇'; // Ensure icon shows muted
                    alert("Video playback requires user interaction. Please click the play button or unmute the player.");
                });

            } else if (channel.type === 'iframe' || channel.type === 'youtube') {
                iframePlayer.style.display = 'block';
                iframePlayer.src = channel.url;
                unmuteButton.style.display = 'none'; // Iframe content manages its own audio

                iframePlayer.onload = () => {
                    console.log('Iframe loaded successfully.');
                    showLoading(false);
                };
                iframePlayer.onerror = () => {
                    console.error("Iframe failed to load.");
                    showLoading(false);
                    placeholder.style.display = 'block';
                    iframePlayer.style.display = 'none'; // Hide iframe on error
                    alert("This embedded content could not be loaded. It might be blocked or unavailable.");
                };
            } else {
                console.warn('Unknown channel type or URL is missing for channel:', channel);
                showLoading(false);
                placeholder.style.display = 'block';
                alert("No playable source found for this channel.");
            }
        }

        function updateChannelDropdown(data) {
            const currentSelectedValue = select.value;
            select.innerHTML = '<option value="">👉📺📺📺</option>'; // Always include the default option

            data.forEach((channel, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = channel.name;
                select.appendChild(option);
            });
            console.log('Channel dropdown updated with', data.length, 'channels.');

            // Attempt to re-select previous channel if it still exists
            if (currentSelectedValue !== "") {
                const reselectIndex = parseInt(currentSelectedValue, 10);
                if (!isNaN(reselectIndex) && reselectIndex >= 0 && reselectIndex < data.length) {
                    console.log('Attempting to re-select channel:', data[reselectIndex].name);
                    select.value = reselectIndex;
                    playChannel(channelsData[reselectIndex]);
                } else {
                    console.warn('Previously selected channel index invalid or not found. Resetting player and dropdown.');
                    select.value = ""; // Reset dropdown to default
                    resetPlayers();
                    placeholder.style.display = 'block'; // Show placeholder
                }
            } else {
                // If no channel was previously selected, or if dropdown was reset, show placeholder
                console.log('No channel previously selected or dropdown reset. Showing placeholder.');
                resetPlayers();
                placeholder.style.display = 'block';
            }
        }

        async function checkAndPopulateChannels() {
            try {
                const urlWithCacheBuster = `${githubJsonUrl}?cacheBuster=${new Date().getTime()}`;
                console.log('Fetching channels data from:', urlWithCacheBuster);
                const response = await fetch(urlWithCacheBuster);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                const currentJsonString = JSON.stringify(data);

                if (lastKnownJsonContent === null || currentJsonString !== lastKnownJsonContent) {
                    console.log('channels.json data changed or first load. Updating webpage...');
                    channelsData = data;
                    updateChannelDropdown(channelsData);
                    lastKnownJsonContent = currentJsonString;
                } else {
                    console.log('No new changes detected in channels.json.');
                }

            } catch (error) {
                console.error('Failed to fetch or process channels data:', error);
                // If channel data fetching fails, ensure player is reset to placeholder
                resetPlayers();
                placeholder.style.display = 'block';
                alert("Failed to load channel list. Please check your internet connection and try refreshing the page.");
            }
        }

        function updateViewerCount() {
            let change = Math.floor(Math.random() * (2 * fluctuationAmount + 1)) - fluctuationAmount;
            currentViewers += change;

            // Ensure viewer count stays within bounds
            if (currentViewers < minViewers) currentViewers = minViewers;
            if (currentViewers > maxViewers) currentViewers = maxViewers;

            currentViewerCountSpan.textContent = currentViewers.toLocaleString();
        }

        // Event listener for channel selection
        select.addEventListener('change', (event) => {
            const selectedValue = event.target.value;
            if (selectedValue === "") {
                console.log('Dropdown reset to default option (no channel selected).');
                resetPlayers();
                placeholder.style.display = 'block'; // Show placeholder when nothing is selected
            } else {
                const selectedIndex = parseInt(selectedValue, 10);
                if (!isNaN(selectedIndex) && selectedIndex >= 0 && selectedIndex < channelsData.length) {
                    playChannel(channelsData[selectedIndex]);
                } else {
                    console.error('Invalid channel selected from dropdown:', selectedIndex);
                    resetPlayers();
                    placeholder.style.display = 'block';
                    alert("Selected channel is invalid or no longer available.");
                }
            }
        });

        // Initialize everything on page load
        document.addEventListener('DOMContentLoaded', () => {
            initializeVideoJs(); // Initialize Video.js
            checkAndPopulateChannels(); // Initial load of channels and player state
            setInterval(checkAndPopulateChannels, pollingInterval); // Periodically check for updates
            setInterval(updateViewerCount, updateInterval); // Update viewer count
            updateViewerCount(); // Initial update of viewer count
        });
    </script>
</body>
</html>
